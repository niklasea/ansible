[Unit]
Description=Unbound - Validating, recursive, and caching DNS resolver
Documentation=man:unbound(8)
After=network.target unbound-anchor.service
Before=network-online.target nss-lookup.target
Wants=unbound-anchor.service nss-lookup.target

[Service]
ExecStartPre={{ unbound_install_dir }}/sbin/unbound-checkconf
ExecStart={{ unbound_install_dir }}/sbin/unbound
ExecReload={{ unbound_install_dir }}/sbin/unbound-control reload

ReadOnlyPaths={{ unbound_conf_dir }}
ReadWritePaths={{ unbound_state_dir }} {{ unbound_pidfile_dir }}

# Isolate service from the rest of the system
ProtectSystem=strict
ProtectHome=true
PrivateDevices=true
PrivateTmp=true
ProtectControlGroups=true
ProtectKernelModules=true
ProtectKernelTunables=true
RestrictNamespaces=true
RestrictRealtime=true
RestrictSUIDSGID=true
RestrictAddressFamilies=AF_INET AF_INET6 AF_NETLINK AF_UNIX
MemoryDenyWriteExecute=true
SystemCallArchitectures=native
LockPersonality=true
NoNewPrivileges=true
CapabilityBoundingSet=CAP_IPC_LOCK CAP_NET_BIND_SERVICE CAP_SETGID CAP_SETUID CAP_SYS_CHROOT CAP_SYS_RESOURCE

[Install]
WantedBy=multi-user.target
